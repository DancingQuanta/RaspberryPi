##### usefull #####

+ f *.pdf & t r
p gdrive Unite
  tmux has-session -t unite
  if [ "$?" -eq 1 ] ; then tmux new-session -d -s unite ; fi
  tmux send -t unite "./unite" ENTER

+ f * & t t
A move to btsync folder
  set %t
  while [ -n "$1" ] ; do
    mv "$1" "/media/hdd/btsync/$(basename "$1")"
    shift
  done

+ f *.tif | f *.tiff | f *.TIF & t t
J Convert TIFF to JPG
  set %t
  while [ -n "$1" ] ; do
    convert "$1" "`$1 | cut -d '.' -f1`.jpg"
    shift
  done

+ f * & t t
B upload to dropbox
  echo "clear" > ~/dropbox.sh
  d=%d
  echo "cd $d" >> ~/dropbox.sh
  set %t
  while [ -n "$1" ] ; do
    echo "dropbox_uploader upload \"$1\" \"$1\"" >> ~/dropbox.sh
    shift
  done
  echo "pushbullet push all note Raspberry_Pi FilesUploadedToDropbox" >> ~/dropbox.sh
  tmux has-session -t dropbox
  if [ "$?" -eq 1 ] ; then tmux new-session -d -s dropbox ; fi
  tmux send -t dropbox 'sh ~/dropbox.sh' ENTER
  tmux send -t dropbox 'rm ~/dropbox.sh' ENTER

+ f * & t r
C download from dropbox
  dropbox_uploader download %{Dropbox Filename}
  
+ f * & t t
D upload to google drive
  echo "clear" > ~/google_drive.sh
  d=%d
  echo "cd $d" >> ~/google_drive.sh
  set %t
  while [ -n "$1" ] ; do
    echo "drive push \"$1\"" >> ~/google_drive.sh
    shift
  done
  echo "pushbullet push all note Raspberry_Pi FilesUploadedToGoogleDrive" >> ~/google_drive.sh
  tmux has-session -t dropbox
  if [ "$?" -eq 1 ] ; then tmux new-session -d -s dropbox ; fi
  tmux send -t dropbox 'sh ~/google_drive.sh' ENTER
  tmux send -t dropbox 'rm ~/google_drive.sh' ENTER

+ f * & t r
E download from google drive
  drive pull %{Dropbox Filename}

##### backup #####

+ f backup & t r
1 sync /media/hdd/photos to flickr
  tmux has-session -t flickr
  if [ "$?" -eq 1 ] ; then tmux new-session -d -s flickr ; fi
  tmux send -t flickr 'flickrsmartsync --sync-path /media/hdd/photos' ENTER
  tmux send -t flickr 'pushbullet push all note "Rasperry Pi" "flickr: sync finished"' ENTER

+ f backup & t r
2 sync /media/hdd/rclone with Google Drive/rclone
  tmux has-session -t rclone
  if [ "$?" -eq 1 ] ; then tmux new-session -d -s rclone ; fi
  tmux send -t rclone 'rclone --config="/home/pi/.rclone.conf" sync pi://media/hdd/rclone gdrive://rclone' ENTER
  tmux send -t rclone 'pushbullet push all note "Rasperry Pi" "rclone: sync finished"' ENTER

+ f backup & t r
3 sync /media/hdd/photos => Google Drive/photos
  tmux has-session -t rclone
  if [ "$?" -eq 1 ] ; then tmux new-session -d -s rclone ; fi
  tmux send -t rclone 'rclone --config="/home/pi/.rclone.conf" sync pi://media/hdd/photos gdrive://Photos' ENTER
  tmux send -t rclone 'pushbullet push all note "Rasperry Pi" "rclone: Photos sync finished"' ENTER
  
+ f backup & t r
4 sync Google Drive/photos => /media/hdd/photos
  tmux has-session -t rclone
  if [ "$?" -eq 1 ] ; then tmux new-session -d -s rclone ; fi
  tmux send -t rclone 'rclone --config="/home/pi/.rclone.conf" sync gdrive://Photos pi://media/hdd/photos' ENTER
  tmux send -t rclone 'pushbullet push all note "Rasperry Pi" "rclone: Photos sync finished"' ENTER

+ f backup & t r
5 shrink photos to family google+ account
  tmux has-session -t gplus
  if [ "$?" -eq 1 ] ; then tmux new-session -d -s gplus ; fi
  tmux send -t gplus 'picasawebsync.py -d /media/hdd/photos --shrink' ENTER
  tmux send -t gplus 'pushbullet push all note "Rasperry Pi" "gplus: Photos sync to family account finished"' ENTER

+ f backup & t r
6 backup youtube files to /hdd/youtube
  cat > /tmp/youtube_task.sh << 'EOF'
  clear
  read -e -p "Youtube Username: " -i "@gmail.com" USER
  read -e -p "Youtube Password: " -s PASS
  google youtube list > /tmp/youtube.txt
  while read ligne
  do 
    FILENAME=`echo "$ligne" | cut -d ',' -f  1`
    if [ "${FILENAME: -4}" != ".avi" ] ; then FILENAME="$FILENAME.avi" ; fi
    URL=`echo "$ligne" | cut -d ',' -f  2`
    youtube-dl --username $USER --password $PASS --twofactor -o "/media/hdd/youtube/$FILENAME" "$URL"
  done < /tmp/youtube.txt
  rm /tmp/youtube.txt
  rm /tmp/youtube_task.sh
  EOF
  tmux has-session -t youtube_dl
  if [ "$?" -eq 1 ] ; then tmux new-session -d -s youtube_dl ; fi
  tmux send -t youtube_dl 'bash /tmp/youtube_task.sh' ENTER
  
##### system #####

+ f system & t r
i dropbox info
  clear && ~/dropbox_uploader.sh info
  printf 'Press [Enter] key to continue...'
  read null

+ f system & t r
u dropbox unlink
  clear && ~/dropbox_uploader.sh unlink

+ f system & t r
c raspi-config
  sudo raspi-config

+ f system & t r
a update/upgrade
  clear
  sudo apt-get -y autoremove
  sudo apt-get -y update
  sudo apt-get -y dist-upgrade
  sudo apt-get -y upgrade
  
+ f system & t r
h shutdown
  clear && sudo halt

+ f system & t r
r reboot
  clear && sudo reboot

##### config #####

+ f system & t r
i init youtube upload
  google youtube post -u %{Enter your gmail address} 

+ f system & t r
p init pushbullet API
  sudo curl https://raw.githubusercontent.com/Red5d/pushbullet-bash/master/pushbullet -o /usr/bin/pushbullet
  sudo chmod a+x /usr/bin/pushbullet
  clear && echo "Please visit https://www.pushbullet.com/account and"
  read -p "Enter Access Token: " API
  echo "API_KEY=$API" > ~/.config/pushbullet
  pushbullet push all note "Pushbullet tested :)"
  
+ f system & t r
t init dropbox
  sudo curl https://raw.githubusercontent.com/andreafabrizi/Dropbox-Uploader/master/dropbox_uploader.sh -o /usr/bin/dropbox_uploader
  sudo chmod a+x /usr/bin/dropbox_uploader
  clear && dropbox_uploader init


##### 3rd party #####

+ f 3rd_party  & t r
b start btsync
  clear && sudo btsync --webui.listen 0.0.0.0:8888

+ f 3rd_party & t r
k stop btsync
  clear && sudo killall btsync
  
+ f 3rd_party & t r
r minidlna reload
  clear && sudo service minidlna force-reload

+ f 3rd_party  & t r
t minidlna status
  clear && sudo service minidlna status
  printf 'Press [Enter] key to continue...'
  read null

+ f 3rd_party & t r
s transmission start
  clear && sudo service transmission-daemon start
  
+ f 3rd_party & t r
t transmission status
  clear && sudo service transmission-daemon status
  printf 'Press [Enter] key to continue...'
  read null

+ f 3rd_party & t r
p transmission stop
  clear && sudo service transmission-daemon stop

+ f 3rd_party & t r
m sst start
  clear && omxplayer http://hi1.streamingsoundtracks.com:8000
  
+ f 3rd_party & t r
m sst stop
  clear && killall omxplayer

+ f 3rd_party & t r
y Youtube Download Playlist
  tmux has-session -t youtube_dl
  f [ "$?" -eq 1 ] ; then tmux new-session -d -s youtube_dl ; fi
  tmux send -t youtube "youtube-dl -cit --netrc --max-quality FORMAT --output '/media/hdd/youtube/%(title)s.%(ext)s' ~Playlist:http://www.youtube.com/playlist?list=~" ENTER

##### gopro #####  

+ f 3rd_party & t r
g gopro: sd copy
  cat >> ~/gopro_task.sh << EOF
  clear
  sudo mkdir /media/gopro
  sudo mount /dev/sdb1 /media/gopro
  mkdir /media/hdd/gopro/photos /media/hdd/gopro/videos
  cp -v /media/gopro/DCIM/???GOPRO/*.JPG /media/hdd/gopro/photos
  cp -v /media/gopro/DCIM/???GOPRO/*.MP4 /media/hdd/gopro/videos
  pushbullet push all note "photos and videos from gopro are saved"
  EOF
  tmux has-session -t gopro
  if [ "$?" -eq 1 ] ; then tmux new-session -d -s gopro ; fi
  tmux send -t gopro 'sh ~/gopro_task.sh' ENTER
  
+ f *.MP4 & t r
g gopro: concat & upload
  tmux has-session -t gopro
  if [ "$?" -eq 1 ] ; then tmux new-session -d -s gopro ; fi
  clear
  tmux send -t gopro 'clear' ENTER
  tmux send -t gopro 'cd %d' ENTER
  tmux send -t gopro 'mencoder `ls %d/*.MP4 | sort` -ovc copy -oac pcm -o %d/youtube.avi' ENTER
  tmux send -t gopro 'youtube-upload --title="Video" --category="Entertainment" --privacy="private" --location="=" --client-secrets="/home/pi/.config/youtube.json" "%d/youtube.avi"' ENTER
  tmux send -t gopro 'pushbullet push all note "Concatenated & Uploaded to Youtube"' ENTER

##################################################################################################
+ f *.MP4 & t t
y upload to youtube test
  for i in %t; do
   echo "$i"
  done


+ f *.MP4 & t t
y upload to youtube
  mkdir /media/hdd/tmp
  clear
  cd "%d"
  for f in %t; do
    cat > /tmp/youtube_task.sh << 'EOF'
    mv "$f" /media/hdd/tmp/video.avi
    youtube-upload --title="$f" --category="Entertainment" --privacy="private" \
    --location="=" --client-secrets="/home/pi/.config/youtube.json" /media/hdd/tmp/video.avi
    mv /media/hdd/tmp/video.avi "$f"
    pushbullet push all note "Raspberry Pi" "La vidéo $f est maintenant sur YouTube"
    EOF
  done
  tmux has-session -t youtube
  if [ "$?" -eq 1 ] ; then tmux new-session -d -s youtube ; fi
  tmux send -t youtube 'sh /tmp/youtube_task.sh' ENTER

+ f 3rd_party & t r
g gopro: create stopmotion
  cd %d
  mkdir CROP
  for img in *.JPG; do
  convert "$img" -crop 2592x1456+0+488 "CROP/$img-CROP.JPG" #bottom
  #convert $img -crop 2592x1456+0+0 CROP/$img-CROP.JPG #top
  #convert $img -crop 2592x1456+0+244 CROP/$img-CROP.JPG #middle
  done
  fi
  obr=$(($width * $height * 60 * 25 / 256))
  opt="vbitrate=$obr:mbd=2:keyint=132:vqblur=1.0:cmp=2:subcmp=2:dia=2:mv0:last_pred=3"
  codec="msmpeg4v2"
  ls -1 *-CROP.JPG >  files.lst
  mencoder -ovc lavc -lavcopts vcodec=$codec:vpass=1:$opt -mf type=jpg:w=$width:h=$height:fps=15 -vf harddup -nosound -o /dev/null mf://@files.lst
  mencoder -ovc lavc -lavcopts vcodec=$codec:vpass=2:$opt -mf type=jpg:w=$width:h=$height:fps=15 -vf harddup -nosound -o video.avi mf://@files.lst
  rm -f divx2pass.log
  f

+ f *.avi | f *.AVI & t t
q x286 test
  tmux has-session -t mencoder
  if [ "$?" -eq 1 ] ; then tmux new-session -d -s mencoder ; fi
  tmux send -t mencoder 'clear' ENTER
  tmux send -t mencoder 'cd %d' ENTER
  set %t
  while [ -n "$1" ]; do
     tmux send -t mencoder 'mencoder -vf yadif=1 -ovc x264 -oac mp3lame -o test.x264.avi %t' ENTER
    shift
  done
  tmux send -t mencoder 'echo "La vidéo %t est maintenant compilée" | sendxmpp -t cat .\email' ENTER

+ f *.avi | f *.AVI & t t
m merge videos mp3
  tmux has-session -t mencoder
  if [ "$?" -eq 1 ] ; then tmux new-session -d -s mencoder ; fi
  tmux send -t mencoder 'clear' ENTER
  tmux send -t mencoder 'cd %d' ENTER
  tmux send -t mencoder 'mencoder -ovc copy -oac mp3lame -o %d.avi %t' ENTER
  tmux send -t mencoder 'pushbullet push all note "Rasperry Pi" "La vidéos %d.avi est compilée"' ENTER

##### gphotos2 #####

+ f *.jpg | f *.JPG & t t
P gphotos2 to hdd
  clear
  path=/media/hdd/photos
  stamp=$(date +%%Y%%m%%d%%H%%M%%S)
  mkdir -p "${path}/${stamp}"
  cd "${path}/${stamp}"
  gphoto2 --get-all-files --filename "%%Y%%m%%d%%H%%M%%S.%%C"
    if [ $? != 0 ]; then
    echo "*** error executing gphoto2, aborting."
    popd &> /dev/null
    exit 1
    fi
  google picasa create ${stamp} ${path}/${stamp}/*.JPG

+ d * & t d
e write exif when missing in jpg files
  cat > ~/exif_task.sh << 'EOF'
  clear
  find "%d" -iname "*.jpg" -type f | sort | while read FILE ; do
    EXI=`exiv2 "$FILE" 2> null | grep "Image timestamp" | cut -d ' ' -f 4 | tr ':' ' '`
    DAT=`echo "$(dirname "$FILE")" | rev | cut -d '/' -f 1 | rev | cut -d ' ' -f  1 | tr '-' ':'`
    if [ -z "$EXI" ]; then
      exiv2 -M "add Exif.Photo.DateTimeOriginal $DAT 00:00:00" "$FILE"
    fi
    printf "\r$(basename "$FILE")"
  done
  EOF
  tmux has-session -t photos
  if [ "$?" -eq 1 ] ; then tmux new-session -d -s photos ; fi
  tmux send -t photos 'sh ~/exif_task.sh' ENTER
  tmux send -t photos 'rm ~/exif_task.sh' ENTER

+ d * & t d
R Rename photos
  cat > ~/rename_task.sh << 'EOF'
  if [ ! -f /usr/bin/exiv2 ]; then pushbullet push all note "Rasperry Pi" "ERROR: Please install exiv2"; exit; fi
  # Loop through files, renaming each to a YYYY:MM:DD_HH:MM:SS_#####.JPG based name
  COUNTER=1
  find "%d" -iname "*.jpg" -type f | sort | while read FILE ; do
    EXIF=`exiv2 "$FILE" 2> null | grep "Image timestamp" | cut -d ' ' -f 4,5 | tr ' ' '-'`
    NEWFILE="$EXIF-$(printf '%%05d' $COUNTER).JPG"
    echo "`basename "$FILE"`=>$NEWFILE"
    mv -u "$FILE" "`dirname "$FILE"`/$NEWFILE"
    COUNTER=$((COUNTER + 1))
  done
  # Loop again through files, renaming as "IMG_#####.JPG"
  COUNTER=1
  find "%d" -iname "*.jpg" -type f | sort | while read FILE ; do 
    NEWNAME="IMG_$(printf "%%05d" $COUNTER).JPG"
    mv "$FILE" "`dirname "$FILE"`/$NEWNAME"
    COUNTER=$((COUNTER + 1))
  done
  rm -f ~/rename_task.sh
  pushbullet push all note "Rasperry Pi" "Photos Renamer Done"
  EOF
  tmux has-session -t photos
  if [ "$?" -eq 1 ] ; then tmux new-session -d -s photos ; fi
  tmux send -t photos 'sh ~/rename_task.sh' ENTER
  tmux send -t photos 'rm ~/rename_task.sh' ENTER

+ d * & t d
R Do list of error JPG exif with folder name
  cat > ~/checkjpg_task.sh << 'EOF'
  if [ ! -f /usr/bin/exiv2 ]; then echo "ERROR: Please install exiv2"; exit; fi
  printf "IMG_XXXXX.JPG:DIR  DA TE==>EXIF DA TE\n" > "/tmp/photos.txt"
  # Loop through files, renaming each to a YYYY:MM:DD_HH:MM:SS_#####.JPG based name
  COUNTER=1
  find "%d" -iname "*.jpg" -type f | sort | while read FILE ; do 
  EXI=`exiv2 "$FILE" 2> null | grep "Image timestamp" | cut -d ' ' -f 4 | tr ':' ' '`
  printf "$(basename "$FILE"):" >> "/tmp/photos.txt" 
  DAT=`echo "$(dirname "$FILE")" | rev | cut -d '/' -f 1 | rev | cut -d ' ' -f  1 | tr '-' ' '`
  printf "$DAT==>$EXI" >> "/tmp/photos.txt"
    if [ -z "$EXI" ]; then
      printf " NO  DA TE" >> "/tmp/photos.txt"
    fi
    if [ "$DAT" != "$EXI" ] ; then 
      printf " NOT MATCH" >> "/tmp/photos.txt"
    fi
  printf "\n" >> "/tmp/photos.txt"
  done
  EOF
  tmux has-session -t photos
  if [ "$?" -eq 1 ] ; then tmux new-session -d -s photos ; fi
  tmux send -t photos 'sh ~/checkjpg_task.sh' ENTER
  #tmux send -t photos 'rm ~/checkjpg_task.sh' ENTER
  
##### update #####

+ f update & t r
u update mc menu
  clear && curl -o ~/.config/mc/menu https://raw.githubusercontent.com/ManuCart/ServicePi/master/menu

##### tmux #####

+ f tmux & t r
1 attach dropbox session
  tmux attach-session -t dropbox

+ f tmux & t r
2 attach flickr session
  tmux attach-session -t flickr

+ f tmux & t r
3 attach gplus session
  tmux attach-session -t gplus

+ f tmux & t r
4 attach mencoder session
  tmux attach-session -t mencoder

+ f tmux & t r
5 attach photos session
  tmux attach-session -t photos

+ f tmux & t r
6 attach rclone session
  tmux attach-session -t rclone

+ f tmux & t r
7 attach gopro session
  tmux attach-session -t gopro

+ f tmux & t r
8 attach youtube session
  tmux attach-session -t youtube

+ f tmux & t r
9 attach youtube_dl session
  tmux attach-session -t youtube_dl

##### useless ######

+ f *.djv | f *.djvu & t n
Décompose un fichier djvu en PBM
  x=0
  cible=""
  mkdir -p /tmp/djvu/
  mkdir -p /tmp/pbm/
  djvmcvt -i %f /tmp/djvu/ /tmp/index.djv
  find "/tmp/djvu/" -iname "*.djv" -type f | while read n; do
    xi=`expr $xi + 1`
    echo $xi
    ddjvu -format=tiff "$n" "/tmp/pbm/$xi.TIF"
  done

+ f *.jpg | f *.JPG & t r
e Affiche l'EXIF de la photo
  clear
  exiv2 %f
  printf 'Press [Enter] key to continue...'
  read null

+ f *.pdf | f *.PDF & t t
p Transforme un fichier PDF sécurisé en normal
  set %t
  while [ -n "$1" ]; do
    gs -dBATCH -dNOPAUSE -q -sDEVICE=pdfwrite -sOutputFile="$1.test.pdf" "$1"
    shift
  done

+ f *.eps | f *.EPS | f *.ai | f *.AI & t t
s Convertir Un fichier EPS,AI en SVG
  set %t
  while [ -n "$1" ]; do
    pstoedit -f plot-svg $1 $1.svg
    shift
  done
